"use client";

import { ReactNode, useState } from "react";
import Link from "next/link";
import { usePathname, useRouter } from "next/navigation";
import {
  Menu,
  X,
  LayoutDashboard,
  FilePlus,
  List,
  BarChart2,
  PanelRightOpen,
  PanelLeftOpen,
  LayoutList,
  LogOut,
} from "lucide-react";
import { AllowOnlyAuth } from "../../components/AllowOnlyAuth";
import { signOut } from "firebase/auth";
import { auth } from "../../lib/firebaseconfig";

function DashboardLayout({ children }: { children: ReactNode }) {
  const pathname = usePathname();
  const router = useRouter();

  // Sidebar states
  const [isMobileOpen, setIsMobileOpen] = useState(false);
  const [isMinified, setIsMinified] = useState(false);

  const navItems = [
    {
      name: "Dashboard",
      href: "/",
      icon: <LayoutDashboard size={14} />,
    },
    { name: "Add New", href: "/dashboard/publish", icon: <FilePlus size={14} /> },
    { name: "All Posts", href: "/dashboard/all-posts", icon: <LayoutList size={14} /> },
    // { name: "Reports", href: "/dashboard/reports", icon: <BarChart2 size={14} /> },
  ];


  function handleLogout() {
    signOut(auth).then(() => {
      router.push("/signin");
    }).catch((error) => {
      alert(error);
    });
  
  }
    

  // const bottomNav = [
  //   {
  //     name: "Logout",
  //     href: "/signin",
  //     icon: <LogOut size={14} />,
  //   },
  // ];

  return (
    <div className="flex h-screen bg-gray-50">
      {/* Sidebar */}
      <div
        className={`fixed top-0 left-0 h-full z-40 bg-white border-r transition-all duration-300 
          ${isMinified ? "w-16" : "w-64"} 
          ${isMobileOpen ? "translate-x-0" : "-translate-x-full"} 
          lg:translate-x-0`}
      >
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b h-14">
          {!isMinified && (
            <span className="text-xl font-bold text-black"><svg xmlns="http://www.w3.org/2000/svg" width="111" height="21" viewBox="0 0 111 21" fill="none">
<g clip-path="url(#clip0_458_514)">
<path d="M57.9429 15.6906C57.9403 14.2385 57.9762 12.8655 57.9256 11.4962C57.8557 9.60358 56.7958 8.67289 55.0538 8.89432C54.0287 9.02462 53.268 9.75666 53.124 10.9264C53.0098 11.8537 53.0203 12.8016 53.0143 13.7407C53.0004 15.9393 53.0099 18.1381 53.0099 20.3485C51.6464 20.3485 50.3503 20.3485 49.0193 20.3485C49.0193 13.4715 49.0193 6.62552 49.0193 -0.256348C50.3404 -0.256348 51.635 -0.256348 53.016 -0.256348C53.016 2.16556 53.016 4.59009 53.016 7.01462C53.0952 7.069 53.1745 7.12337 53.2537 7.17774C53.4019 6.94514 53.5234 6.68519 53.7026 6.48438C54.8174 5.2347 56.1962 4.72955 57.7863 4.91326C60.0676 5.17684 61.6999 6.6608 61.8175 9.12542C61.9949 12.8431 61.8638 16.5776 61.8638 20.3425C60.6161 20.3425 59.3236 20.3425 57.9429 20.3425C57.9429 18.8162 57.9429 17.2937 57.9429 15.6906Z" fill="black"/>
<path d="M80.598 18.6982C76.2718 22.3139 67.8593 21.409 65.512 13.7834C63.4256 7.00523 67.9646 0.230152 74.6163 0.187306C77.158 0.170936 79.4657 0.835215 81.4161 2.66054C81.6021 2.83468 81.7855 3.01209 82.0178 3.23339C81.129 4.33122 80.2822 5.37701 79.4401 6.41712C75.6786 3.61148 72.8524 3.52672 70.7597 6.11819C68.7758 8.57505 68.8511 12.6098 70.9252 14.9792C73.0506 17.4071 76.0767 17.2112 79.5055 14.4312C80.3587 15.33 81.2105 16.2274 82.1399 17.2064C81.6233 17.7077 81.1317 18.1848 80.598 18.6982Z" fill="#ED1E26"/>
<path d="M97.7382 7.53255C99.7642 10.1585 100.221 13.0367 98.9102 16.0699C97.5871 19.1317 95.2003 20.5642 92.0726 20.7052C88.408 20.8704 85.0133 18.1874 84.3586 14.1839C83.6629 9.92968 86.4489 5.67751 90.43 5.0291C93.2318 4.57275 95.6944 5.2536 97.7382 7.53255ZM92.9107 16.8659C94.5705 16.385 95.5561 14.9782 95.6235 12.994C95.6913 10.994 94.5719 9.25149 92.9018 8.75713C91.2238 8.26045 89.4957 8.98016 88.7338 10.5869C87.9889 12.1576 87.9973 13.7696 88.9281 15.2523C89.844 16.7114 91.1823 17.2188 92.9107 16.8659Z" fill="#ED1E26"/>
<path d="M34.46 12.139C34.46 14.9057 34.46 17.5918 34.46 20.3285C33.1104 20.3285 31.7985 20.3285 30.411 20.3285C30.411 19.7027 30.411 19.0758 30.411 18.2619C29.4515 19.4937 28.4665 20.3303 27.1171 20.5944C24.1851 21.1684 21.7274 19.2816 21.5466 16.0822C21.3951 13.4018 21.4743 10.7063 21.4553 8.01748C21.4489 7.10643 21.4543 6.19529 21.4543 5.23511C22.7913 5.23511 24.0813 5.23511 25.4388 5.23511C25.4508 5.43629 25.476 5.66455 25.4762 5.89284C25.4791 8.36744 25.4737 10.8421 25.4821 13.3166C25.4836 13.7448 25.5112 14.1776 25.5742 14.6001C25.7693 15.9074 26.5516 16.6439 27.7659 16.697C29.0911 16.755 29.9919 16.0867 30.2669 14.7882C30.3656 14.3223 30.4032 13.8328 30.4055 13.3537C30.4182 10.6666 30.4116 7.97947 30.4116 5.23879C31.7507 5.23879 33.063 5.23879 34.46 5.23879C34.46 7.50534 34.46 9.78183 34.46 12.139Z" fill="black"/>
<path d="M45.7008 8.88396C44.6837 8.88471 43.7375 8.88471 42.7351 8.88471C42.7351 11.1901 42.7154 13.4386 42.7467 15.6864C42.7566 16.3978 43.1667 16.8626 43.8578 16.8165C44.5413 16.771 45.218 16.6079 45.9775 16.4833C45.9775 17.4311 45.9961 18.4654 45.9591 19.4974C45.9529 19.6681 45.733 19.8956 45.5614 19.9834C44.0233 20.7709 42.4183 20.8714 40.8134 20.3081C39.4691 19.8362 38.6984 18.3684 38.6842 16.4048C38.6663 13.9349 38.6799 11.4648 38.6799 8.92563C38.1458 8.92563 37.6351 8.92563 37.0657 8.92563C37.0657 7.66829 37.0657 6.47709 37.0657 5.22313C37.5477 5.22313 38.0615 5.22313 38.6626 5.22313C38.6626 3.8952 38.6626 2.6241 38.6626 1.32983C40.0433 1.32983 41.3367 1.32983 42.6973 1.32983C42.6973 2.59867 42.6973 3.84902 42.6973 5.16456C43.8277 5.16456 44.8933 5.16456 46.0409 5.16456C46.0409 6.34815 46.0478 7.46735 46.0292 8.58607C46.0276 8.68672 45.8615 8.78423 45.7008 8.88396Z" fill="black"/>
<path d="M108.055 5.85576C108.926 5.06192 109.898 4.83374 111 4.90066C111 6.39979 111 7.86618 111 9.32973C110.945 9.35558 110.904 9.39093 110.86 9.39365C108.045 9.57076 106.645 11.0994 106.539 14.1544C106.504 15.1754 106.526 16.1988 106.524 17.221C106.522 18.2391 106.523 19.2573 106.523 20.327C105.185 20.327 103.892 20.327 102.543 20.327C102.543 15.3336 102.543 10.3191 102.543 5.24474C103.834 5.24474 105.143 5.24474 106.497 5.24474C106.497 6.11209 106.497 6.96557 106.497 7.90097C107.039 7.1828 107.526 6.53771 108.055 5.85576Z" fill="#ED1E26"/>
<path d="M4.8725 19.3183C4.60767 20.4594 3.98931 20.823 2.95365 20.701C2.01788 20.5907 1.06194 20.6777 0 20.6777C0.342199 19.9219 0.625479 19.2425 0.950668 18.5869C2.94332 14.5699 5.43895 11.0165 9.11841 8.59222C12.2543 6.52606 15.6566 5.68801 19.3229 6.17388C19.5841 6.20851 19.8379 6.30843 20.287 6.42988C16.0177 6.47511 12.8005 8.4657 10.0219 11.4567C7.89795 13.743 6.26756 16.4062 4.8725 19.3183Z" fill="#ED1E26"/>
<path d="M14.4423 18.3133C14.1538 17.5944 14.0429 16.6658 13.5728 16.3469C13.0659 16.0031 12.2229 16.2169 11.5264 16.2113C10.2556 16.201 8.98465 16.2083 7.48535 16.2083C8.49406 14.8884 9.35562 13.7141 10.2775 12.5973C10.4454 12.3939 10.8563 12.3958 11.1611 12.3559C11.4551 12.3175 11.7569 12.3476 12.0431 12.3476C12.0665 12.2445 12.1041 12.1743 12.0857 12.1458C11.5024 11.2404 11.9523 10.7135 12.6585 10.2439C13.3774 9.76599 14.0743 9.25008 14.848 8.70337C16.4434 12.7262 18.0034 16.6601 19.5968 20.6779C18.2297 20.6779 16.9585 20.6951 15.6886 20.658C15.5132 20.6529 15.2738 20.4161 15.1859 20.2228C14.913 19.6224 14.6988 18.9912 14.4423 18.3133Z" fill="black"/>
<path d="M4.23024 10.0192C5.40251 7.05457 6.56443 4.15211 7.70108 1.2383C7.85937 0.832523 8.03845 0.663953 8.46459 0.682245C9.38931 0.721943 10.3172 0.674407 11.2422 0.710691C11.4383 0.718386 11.73 0.882483 11.8036 1.05837C12.4137 2.51684 12.9829 3.99499 13.5944 5.5431C9.27042 6.70243 5.93882 9.39525 3.08179 12.9025C3.45848 11.9609 3.83517 11.0193 4.23024 10.0192Z" fill="black"/>
</g>
<defs>
<clipPath id="clip0_458_514">
<rect width="111" height="21" fill="white"/>
</clipPath>
</defs>
</svg></span>
          )}

          {/* Minify toggle (desktop only) */}
          <button
            onClick={() => setIsMinified(!isMinified)}
            className="hidden lg:flex items-center justify-center w-8 h-8 rounded-full hover:bg-gray-100"
          >
            {isMinified ? <PanelLeftOpen strokeWidth={"0.75px"} /> : <PanelRightOpen strokeWidth={"0.75px"} /> }
          </button>

          {/* Close button (mobile only) */}
          <button
            onClick={() => setIsMobileOpen(false)}
            className="lg:hidden flex items-center justify-center w-8 h-8 rounded-full hover:bg-gray-100"
          >
            <X size={18} />
          </button>
        </div>

        {/* Nav */}
        <nav className="flex-1 overflow-y-auto p-2 ">
          <ul className="space-y-1">
            {navItems.map((item) => (
              <li key={item.href}>
                <Link
                  href={item.href}
                  className={`flex items-center gap-x-3 px-3 py-2 rounded-md transition-colors ${
                    pathname === item.href
                      ? "bg-indigo-100 text-indigo-700 font-medium"
                      : "text-gray-700 hover:bg-gray-100"
                  }`}
                >
                  {item.icon}
                  {!isMinified && <span>{item.name}</span>}
                </Link>
              </li>
            ))}
          </ul>
        </nav>

        {/* BOTTOM NAV */}
        <nav className="flex-1 overflow-y-auto p-2 absolute bottom-0 w-full">
          <ul className="space-y-1">
            <button onClick={handleLogout} className="flex items-center justify-center bg-red-500 text-white gap-x-3 px-3 py-2 rounded-md transition-colors w-full">
              Logout
            </button>
            {/* {bottomNav.map((item) => (
              <li className="w-full" key={item.href}>
                <Link
                  href={item.href}
                  className={`flex items-center gap-x-3 px-3 py-2 rounded-md transition-colors w-full ${
                    pathname === item.href
                      ? "bg-indigo-100 text-indigo-700 font-medium"
                      : "text-gray-700 hover:bg-gray-100"
                  }`}
                >
                  {item.icon}
                  {!isMinified && <span>{item.name}</span>}
                </Link>
              </li>
            ))} */}
          </ul>
        </nav>
      </div>

      {/* Main content */}
      <div
        className={`flex-1 flex flex-col transition-all duration-300 ${
          isMinified ? "lg:ml-16" : "lg:ml-64"
        }`}
      >
        {/* Navbar */}
        <header className="fixed left-0 top-0 right-0 flex items-center justify-between px-6 py-4 bg-white border-b h-14 z-30
        ">
          {/* Mobile menu button */}
          <button
            onClick={() => setIsMobileOpen(true)}
            className="lg:hidden flex items-center justify-center w-9 h-9 rounded-md hover:bg-gray-100"
          >
            <Menu size={20} />
          </button>

          <div className="text-xl font-semibold ml-16"><svg xmlns="http://www.w3.org/2000/svg" width="111" height="21" viewBox="0 0 111 21" fill="none">
<g clip-path="url(#clip0_458_514)">
<path d="M57.9429 15.6906C57.9403 14.2385 57.9762 12.8655 57.9256 11.4962C57.8557 9.60358 56.7958 8.67289 55.0538 8.89432C54.0287 9.02462 53.268 9.75666 53.124 10.9264C53.0098 11.8537 53.0203 12.8016 53.0143 13.7407C53.0004 15.9393 53.0099 18.1381 53.0099 20.3485C51.6464 20.3485 50.3503 20.3485 49.0193 20.3485C49.0193 13.4715 49.0193 6.62552 49.0193 -0.256348C50.3404 -0.256348 51.635 -0.256348 53.016 -0.256348C53.016 2.16556 53.016 4.59009 53.016 7.01462C53.0952 7.069 53.1745 7.12337 53.2537 7.17774C53.4019 6.94514 53.5234 6.68519 53.7026 6.48438C54.8174 5.2347 56.1962 4.72955 57.7863 4.91326C60.0676 5.17684 61.6999 6.6608 61.8175 9.12542C61.9949 12.8431 61.8638 16.5776 61.8638 20.3425C60.6161 20.3425 59.3236 20.3425 57.9429 20.3425C57.9429 18.8162 57.9429 17.2937 57.9429 15.6906Z" fill="black"/>
<path d="M80.598 18.6982C76.2718 22.3139 67.8593 21.409 65.512 13.7834C63.4256 7.00523 67.9646 0.230152 74.6163 0.187306C77.158 0.170936 79.4657 0.835215 81.4161 2.66054C81.6021 2.83468 81.7855 3.01209 82.0178 3.23339C81.129 4.33122 80.2822 5.37701 79.4401 6.41712C75.6786 3.61148 72.8524 3.52672 70.7597 6.11819C68.7758 8.57505 68.8511 12.6098 70.9252 14.9792C73.0506 17.4071 76.0767 17.2112 79.5055 14.4312C80.3587 15.33 81.2105 16.2274 82.1399 17.2064C81.6233 17.7077 81.1317 18.1848 80.598 18.6982Z" fill="#ED1E26"/>
<path d="M97.7382 7.53255C99.7642 10.1585 100.221 13.0367 98.9102 16.0699C97.5871 19.1317 95.2003 20.5642 92.0726 20.7052C88.408 20.8704 85.0133 18.1874 84.3586 14.1839C83.6629 9.92968 86.4489 5.67751 90.43 5.0291C93.2318 4.57275 95.6944 5.2536 97.7382 7.53255ZM92.9107 16.8659C94.5705 16.385 95.5561 14.9782 95.6235 12.994C95.6913 10.994 94.5719 9.25149 92.9018 8.75713C91.2238 8.26045 89.4957 8.98016 88.7338 10.5869C87.9889 12.1576 87.9973 13.7696 88.9281 15.2523C89.844 16.7114 91.1823 17.2188 92.9107 16.8659Z" fill="#ED1E26"/>
<path d="M34.46 12.139C34.46 14.9057 34.46 17.5918 34.46 20.3285C33.1104 20.3285 31.7985 20.3285 30.411 20.3285C30.411 19.7027 30.411 19.0758 30.411 18.2619C29.4515 19.4937 28.4665 20.3303 27.1171 20.5944C24.1851 21.1684 21.7274 19.2816 21.5466 16.0822C21.3951 13.4018 21.4743 10.7063 21.4553 8.01748C21.4489 7.10643 21.4543 6.19529 21.4543 5.23511C22.7913 5.23511 24.0813 5.23511 25.4388 5.23511C25.4508 5.43629 25.476 5.66455 25.4762 5.89284C25.4791 8.36744 25.4737 10.8421 25.4821 13.3166C25.4836 13.7448 25.5112 14.1776 25.5742 14.6001C25.7693 15.9074 26.5516 16.6439 27.7659 16.697C29.0911 16.755 29.9919 16.0867 30.2669 14.7882C30.3656 14.3223 30.4032 13.8328 30.4055 13.3537C30.4182 10.6666 30.4116 7.97947 30.4116 5.23879C31.7507 5.23879 33.063 5.23879 34.46 5.23879C34.46 7.50534 34.46 9.78183 34.46 12.139Z" fill="black"/>
<path d="M45.7008 8.88396C44.6837 8.88471 43.7375 8.88471 42.7351 8.88471C42.7351 11.1901 42.7154 13.4386 42.7467 15.6864C42.7566 16.3978 43.1667 16.8626 43.8578 16.8165C44.5413 16.771 45.218 16.6079 45.9775 16.4833C45.9775 17.4311 45.9961 18.4654 45.9591 19.4974C45.9529 19.6681 45.733 19.8956 45.5614 19.9834C44.0233 20.7709 42.4183 20.8714 40.8134 20.3081C39.4691 19.8362 38.6984 18.3684 38.6842 16.4048C38.6663 13.9349 38.6799 11.4648 38.6799 8.92563C38.1458 8.92563 37.6351 8.92563 37.0657 8.92563C37.0657 7.66829 37.0657 6.47709 37.0657 5.22313C37.5477 5.22313 38.0615 5.22313 38.6626 5.22313C38.6626 3.8952 38.6626 2.6241 38.6626 1.32983C40.0433 1.32983 41.3367 1.32983 42.6973 1.32983C42.6973 2.59867 42.6973 3.84902 42.6973 5.16456C43.8277 5.16456 44.8933 5.16456 46.0409 5.16456C46.0409 6.34815 46.0478 7.46735 46.0292 8.58607C46.0276 8.68672 45.8615 8.78423 45.7008 8.88396Z" fill="black"/>
<path d="M108.055 5.85576C108.926 5.06192 109.898 4.83374 111 4.90066C111 6.39979 111 7.86618 111 9.32973C110.945 9.35558 110.904 9.39093 110.86 9.39365C108.045 9.57076 106.645 11.0994 106.539 14.1544C106.504 15.1754 106.526 16.1988 106.524 17.221C106.522 18.2391 106.523 19.2573 106.523 20.327C105.185 20.327 103.892 20.327 102.543 20.327C102.543 15.3336 102.543 10.3191 102.543 5.24474C103.834 5.24474 105.143 5.24474 106.497 5.24474C106.497 6.11209 106.497 6.96557 106.497 7.90097C107.039 7.1828 107.526 6.53771 108.055 5.85576Z" fill="#ED1E26"/>
<path d="M4.8725 19.3183C4.60767 20.4594 3.98931 20.823 2.95365 20.701C2.01788 20.5907 1.06194 20.6777 0 20.6777C0.342199 19.9219 0.625479 19.2425 0.950668 18.5869C2.94332 14.5699 5.43895 11.0165 9.11841 8.59222C12.2543 6.52606 15.6566 5.68801 19.3229 6.17388C19.5841 6.20851 19.8379 6.30843 20.287 6.42988C16.0177 6.47511 12.8005 8.4657 10.0219 11.4567C7.89795 13.743 6.26756 16.4062 4.8725 19.3183Z" fill="#ED1E26"/>
<path d="M14.4423 18.3133C14.1538 17.5944 14.0429 16.6658 13.5728 16.3469C13.0659 16.0031 12.2229 16.2169 11.5264 16.2113C10.2556 16.201 8.98465 16.2083 7.48535 16.2083C8.49406 14.8884 9.35562 13.7141 10.2775 12.5973C10.4454 12.3939 10.8563 12.3958 11.1611 12.3559C11.4551 12.3175 11.7569 12.3476 12.0431 12.3476C12.0665 12.2445 12.1041 12.1743 12.0857 12.1458C11.5024 11.2404 11.9523 10.7135 12.6585 10.2439C13.3774 9.76599 14.0743 9.25008 14.848 8.70337C16.4434 12.7262 18.0034 16.6601 19.5968 20.6779C18.2297 20.6779 16.9585 20.6951 15.6886 20.658C15.5132 20.6529 15.2738 20.4161 15.1859 20.2228C14.913 19.6224 14.6988 18.9912 14.4423 18.3133Z" fill="black"/>
<path d="M4.23024 10.0192C5.40251 7.05457 6.56443 4.15211 7.70108 1.2383C7.85937 0.832523 8.03845 0.663953 8.46459 0.682245C9.38931 0.721943 10.3172 0.674407 11.2422 0.710691C11.4383 0.718386 11.73 0.882483 11.8036 1.05837C12.4137 2.51684 12.9829 3.99499 13.5944 5.5431C9.27042 6.70243 5.93882 9.39525 3.08179 12.9025C3.45848 11.9609 3.83517 11.0193 4.23024 10.0192Z" fill="black"/>
</g>
<defs>
<clipPath id="clip0_458_514">
<rect width="111" height="21" fill="white"/>
</clipPath>
</defs>
</svg></div>

          {/* <button className="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">
            Logout
          </button> */}
        </header>

        {/* Page Content */}
        <main className="px-6 py-16">{children}</main>
      </div>
    </div>
  );
}


export default AllowOnlyAuth(DashboardLayout);